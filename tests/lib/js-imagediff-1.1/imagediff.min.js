// js-imagediff 1.0.3
// (c) 2011-2012 Carl Sutherland, Humble Software
// Distributed under the MIT License
// For original source and documentation visit:
// http://www.github.com/HumbleSoftware/js-imagediff

(function(e,t){var n=this;if(typeof module!="undefined"){try{var r=require("canvas")}catch(i){throw new Error(i.message+"\n"+"Please see https://github.com/HumbleSoftware/js-imagediff#cannot-find-module-canvas\n")}module.exports=t(n,e,r)}else typeof define=="function"&&typeof define.amd=="object"?define(t):n[e]=t(n,e)})("imagediff",function(e,t,n){function p(e,t){var r=n?new n:document.createElement("canvas");return e&&(r.width=e),t&&(r.height=t),r}function d(e,t){return a.width=e,a.height=t,f.clearRect(0,0,e,t),f.createImageData(e,t)}function v(e){return w(e,s)}function m(e){return w(e,r)}function g(e){return w(e,i)}function y(e){return!!e&&!!w(e,o)&&typeof e.width!==u&&typeof e.height!==u&&typeof e.data!==u}function b(e){return v(e)||m(e)||g(e)||y(e)}function w(e,t){return typeof e=="object"&&!!Object.prototype.toString.apply(e).match(t)}function E(e){var t=e.height,n=e.width,r=e.data,i,s,o;a.width=n,a.height=t,i=f.getImageData(0,0,n,t),s=i.data;for(o=e.data.length;o--;)s[o]=r[o];return i}function S(e){if(v(e))return x(e);if(m(e))return T(e);if(g(e))return N(e);if(y(e))return e}function x(e){var t=e.height,n=e.width;return a.width=n,a.height=t,f.clearRect(0,0,n,t),f.drawImage(e,0,0),f.getImageData(0,0,n,t)}function T(e){var t=e.height,n=e.width,r=e.getContext("2d");return r.getImageData(0,0,n,t)}function N(e){var t=e.canvas,n=t.height,r=t.width;return e.getImageData(0,0,r,n)}function C(e){var t=S(e),n=p(t.width,t.height),r=n.getContext("2d");return r.putImageData(t,0,0),n}function k(e,t){return e.width===t.width}function L(e,t){return e.height===t.height}function A(e,t){return L(e,t)&&k(e,t)}function O(e,t,n){var r=e.data,i=t.data,s=r.length,o;n=n||0;if(!A(e,t))return!1;for(o=s;o--;)if(r[o]!==i[o]&&Math.abs(r[o]-i[o])>n)return!1;return!0}function M(e,t,n){return(A(e,t)?_:D)(e,t,n)}function _(e,t,n){var r=e.height,i=e.width,s=d(i,r),o=e.data,u=t.data,a=s.data,f=a.length,l;for(l=0;l<f;l+=4)a[l]=Math.abs(o[l]-u[l]),a[l+1]=Math.abs(o[l+1]-u[l+1]),a[l+2]=Math.abs(o[l+2]-u[l+2]),a[l+3]=Math.abs(255-Math.abs(o[l+3]-u[l+3]));return s}function D(e,t,n){function g(e){f==="top"?(l=0,c=0):(l=Math.floor((r-e.height)/2),c=Math.floor((i-e.width)/2))}var r=Math.max(e.height,t.height),i=Math.max(e.width,t.width),s=d(i,r),o=e.data,u=t.data,a=s.data,f=n&&n.align,l,c,h,p,v,m;for(v=a.length-1;v>0;v-=4)a[v]=255;g(e);for(h=e.height;h--;)for(p=e.width;p--;)v=4*((h+l)*i+(p+c)),m=4*(h*e.width+p),a[v+0]=o[m+0],a[v+1]=o[m+1],a[v+2]=o[m+2];g(t);for(h=t.height;h--;)for(p=t.width;p--;)v=4*((h+l)*i+(p+c)),m=4*(h*t.width+p),a[v+0]=Math.abs(a[v+0]-u[m+0]),a[v+1]=Math.abs(a[v+1]-u[m+1]),a[v+2]=Math.abs(a[v+2]-u[m+2]);return s}function P(){var e;for(e=0;e<arguments.length;e++)if(!b(arguments[e]))throw{name:"ImageTypeError",message:"Submitted object was not an image."}}function H(e,t){return e=document.createElement(e),e&&t&&(e.innerHTML=t),e}function B(e,t){return function(){var n=H("div"),r=H("div","<div>Actual:</div>"),i=H("div","<div>Expected:</div>"),s=H("div","<div>Diff:</div>"),o=c.diff(e,t),u=p(),a;return u.height=o.height,u.width=o.width,n.style.overflow="hidden",r.style.float="left",i.style.float="left",s.style.float="left",a=u.getContext("2d"),a.putImageData(o,0,0),r.appendChild(C(e)),i.appendChild(C(t)),s.appendChild(u),n.appendChild(r),n.appendChild(i),n.appendChild(s),n}}function j(e,t,n){var r=C(e),i,s;n=n||Function,i=r.toDataURL().replace(/^data:image\/\w+;base64,/,""),s=new Buffer(i,"base64"),require("fs").writeFile(t,s,n)}var r=/\[object (Canvas|HTMLCanvasElement)\]/i,i=/\[object CanvasRenderingContext2D\]/i,s=/\[object (Image|HTMLImageElement)\]/i,o=/\[object ImageData\]/i,u="undefined",a=p(),f=a.getContext("2d"),l=e[t],c,h;return h={toBeImageData:function(){return{compare:function(e){return{pass:c.isImageData(e)}}}},toImageDiffEqual:function(){return{compare:function(e,t,n){var r={};return r.pass=c.equal(e,t,n),typeof document!==u&&(r.message=B(e,t)),r},negativeCompare:function(e,t,n){return{pass:!c.equal(e,t,n),message:"Expected not to be equal."}}}}},c={createCanvas:p,createImageData:d,isImage:v,isCanvas:m,isContext:g,isImageData:y,isImageType:b,toImageData:function(e){return P(e),y(e)?E(e):S(e)},equal:function(e,t,n){return P(e,t),e=S(e),t=S(t),O(e,t,n)},diff:function(e,t,n){return P(e,t),e=S(e),t=S(t),M(e,t,n)},jasmine:h,noConflict:function(){return e[t]=l,c}},typeof module!="undefined"&&(c.imageDataToPNG=j),c})